"use strict";const inputElem=document.querySelector(".js-input"),searchButtonElem=document.querySelector(".js-search"),smallElem=document.querySelector(".js-small"),mainElem=document.querySelector(".js-main"),favButton=document.querySelector(".js-favButton"),favPanel=document.querySelector(".js-favPanel"),favList=document.querySelector(".js-favList"),clearAllButton=document.querySelector(".js-clearAll");let favs=[];const listSeriesElem=document.createElement("ul");listSeriesElem.classList.add("js-listSeries");const cloudsElem=document.querySelector(".clouds");function searchHandler(e){return localStorage.getItem("favIdArr")&&(favs=JSON.parse(localStorage.getItem("favIdArr"))),e.preventDefault(),listSeriesElem.parentElement||mainElem.appendChild(listSeriesElem),listSeriesElem.innerHTML="",smallElem.classList.add("hidden"),fetch("http://api.tvmaze.com/search/shows?q="+inputElem.value).then(e=>e.json()).then(e=>paintSeries(e,!1)),!1}function paintSeries(e,t){if(t||0!==e.length){if(t&&0===e.length)return void(favList.innerHTML="<p>You haven't faved any series.<br><br>Please search for some series in the search bar and click on it to fav it.</p>")}else smallElem.classList.toggle("hidden"),smallElem.innerHTML="There were no results for your search.",listSeriesElem.remove();t&&(favList.innerHTML="");for(const a of e)appendSerieToSerieList(a,t)}function appendSerieToSerieList(e,t){let a,n,s,l,r,o;if(a=document.createElement("li"),t){l=e.id,r=e.name,o=e.img;let t=document.createElement("button");t.classList.add("favRemove"),t.innerHTML="X",a.appendChild(t),t.addEventListener("click",favRemoveHandler)}else l=e.show.id,r=e.show.name,o=e.show.image;a.setAttribute("data-id",""+l),n=document.createElement("p"),n.appendChild(document.createTextNode(""+r)),s=document.createElement("img"),o?s.setAttribute("src",""+(t?o:o.medium)):s.src="https://via.placeholder.com/210x295/ffffff/666666/?text=TV",s.setAttribute("alt","Poster of "+r),a.appendChild(n),a.appendChild(s),!t&&isSerieFaved(a,favs)?a.classList.add("fav"):t&&a.classList.add("fav","scaleFaved"),t?favList.appendChild(a):listSeriesElem.appendChild(a)}function isSerieFaved(e,t){for(const a of t)if(a.id===e.dataset.id)return!0;return!1}function favHandler(e){let t;if("LI"===e.target.nodeName)t=e.target;else{if("UL"===e.target.nodeName)return;t=e.target.parentElement}isSerieFaved(t,favs)?(favs.splice(indexOfSerieInFav(t,favs),1),t.classList.remove("fav")):(favs.push({id:t.dataset.id,name:t.childNodes[0].innerHTML,img:t.childNodes[1].src}),t.classList.add("fav")),favs.sort((e,t)=>e.name.toUpperCase()>t.name.toUpperCase()?1:-1),localStorage.setItem("favIdArr",JSON.stringify(favs)),paintSeries(favs,!0)}function indexOfSerieInFav(e,t){for(let a=0;a<t.length;a++)if(t[a].id===e.dataset.id)return a;return-1}function favButtonHandler(){favButton.classList.toggle("rotFav"),favButton.classList.toggle("defaultFavAnimation"),favPanel.classList.toggle("favPanelTransition")}function favRemoveHandler(e){let t=e.currentTarget.parentNode.dataset.id;for(let e=0;e<favs.length;e++)favs[e].id===t&&favs.splice(e,1);localStorage.setItem("favIdArr",JSON.stringify(favs)),paintSeries(favs,!0);for(const e of Array.from(listSeriesElem.childNodes))e.dataset.id===t&&e.classList.remove("fav")}function favRemoveAllHandler(){favs=[],localStorage.setItem("favIdArr",JSON.stringify(favs)),paintSeries(favs,!0);for(const e of Array.from(listSeriesElem.childNodes))e.classList.remove("fav")}function randomInRangeFloat(e,t){return Math.random()*(t-e)+e}function randomInRangeInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}function vwToPx(e){return e*document.documentElement.clientWidth/100}function pxToVw(e){return e*(100/document.documentElement.clientWidth)}function cloudsIniPos(e){for(let t=0;t<(e?1:randomInRangeInt(4,8));t++){const t=randomInRangeInt(1,4),a=document.createElement("object");if(a.setAttribute("type","image/svg+xml"),a.setAttribute("data",`./assets/images/cloud${t}.svg`),a.classList.add("js-cloud","cloud"),cloudsElem.appendChild(a),e){const e=randomInRangeFloat(.2,2);return a.style.top=randomInRangeInt(-5,95)+"vh",a.style.left=-300*e-20+"px",a.style.transform=`scale(${e})`,void(a.dataset.speed=1+1/e)}}for(const e of cloudsElem.childNodes){const t=randomInRangeFloat(.2,2);e.style.top=randomInRangeInt(-5,105)+"vh",e.style.left=randomInRangeInt(-5,105)+"vw",e.style.left=vwToPx(e.style.left.slice(0,-2))+"px",e.style.transform=`scale(${t})`,e.dataset.speed=1+1/t}}function cloudMoveHandler(){for(const e of cloudsElem.childNodes){let t=parseInt(e.style.left.slice(0,-2));e.style.left=t+5*parseFloat(e.dataset.speed)+"px",pxToVw(t)>100&&(e.remove(),cloudsIniPos(!0))}}function init(){localStorage.getItem("favIdArr")&&(favs=JSON.parse(localStorage.getItem("favIdArr"))),favs&&paintSeries(favs,!0),cloudsIniPos(!1)}setInterval(cloudMoveHandler,2e3),searchButtonElem.addEventListener("click",searchHandler),inputElem.addEventListener("submit",searchHandler),inputElem.addEventListener("keyup",searchHandler),listSeriesElem.addEventListener("click",favHandler),favButton.addEventListener("click",favButtonHandler),clearAllButton.addEventListener("click",favRemoveAllHandler);