"use strict";const inputElem=document.querySelector(".js-input"),searchButtonElem=document.querySelector(".js-search"),smallElem=document.querySelector(".js-small"),mainElem=document.querySelector(".js-main"),favButton=document.querySelector(".js-favButton"),favPanel=document.querySelector(".js-favPanel"),favList=document.querySelector(".js-favList"),clearAllButton=document.querySelector(".js-clearAll");let favs=[];const listSeriesElem=document.createElement("ul");listSeriesElem.classList.add("js-listSeries");const cloudsElem=document.querySelector(".js-clouds"),starsElem=document.querySelector(".js-stars"),skyElem=document.querySelector(".js-sky");function searchHandler(e){return localStorage.getItem("favIdArr")&&(favs=JSON.parse(localStorage.getItem("favIdArr"))),e.preventDefault(),listSeriesElem.parentElement||mainElem.appendChild(listSeriesElem),listSeriesElem.innerHTML="",smallElem.classList.add("hidden"),fetch("http://api.tvmaze.com/search/shows?q="+inputElem.value).then(e=>e.json()).then(e=>paintSeries(e,!1)),!1}function paintSeries(e,t){if(t||0!==e.length){if(t&&0===e.length)return void(favList.innerHTML="<p>You haven't faved any series.<br><br>Please search for some series in the search bar and click on it to fav it.</p>")}else smallElem.classList.toggle("hidden"),smallElem.innerHTML="There were no results for your search.",listSeriesElem.remove();t&&(favList.innerHTML="");for(const n of e)appendSerieToSerieList(n,t)}function appendSerieToSerieList(e,t){let n,a,s,r,o,l;if(n=document.createElement("li"),t){r=e.id,o=e.name,l=e.img;let t=document.createElement("button");t.classList.add("favRemove"),t.innerHTML="X",n.appendChild(t),t.addEventListener("click",favRemoveHandler)}else r=e.show.id,o=e.show.name,l=e.show.image;n.setAttribute("data-id",""+r),a=document.createElement("p"),a.appendChild(document.createTextNode(""+o)),s=document.createElement("img"),l?s.setAttribute("src",""+(t?l:l.medium)):s.src="https://via.placeholder.com/210x295/ffffff/666666/?text=TV",s.setAttribute("alt","Poster of "+o),n.appendChild(a),n.appendChild(s),!t&&isSerieFaved(n,favs)?n.classList.add("fav"):t&&n.classList.add("fav","scaleFaved"),t?favList.appendChild(n):listSeriesElem.appendChild(n)}function isSerieFaved(e,t){for(const n of t)if(n.id===e.dataset.id)return!0;return!1}function favHandler(e){let t;if("LI"===e.target.nodeName)t=e.target;else{if("UL"===e.target.nodeName)return;t=e.target.parentElement}isSerieFaved(t,favs)?(favs.splice(indexOfSerieInFav(t,favs),1),t.classList.remove("fav")):(favs.push({id:t.dataset.id,name:t.childNodes[0].innerHTML,img:t.childNodes[1].src}),t.classList.add("fav")),favs.sort((e,t)=>e.name.toUpperCase()>t.name.toUpperCase()?1:-1),localStorage.setItem("favIdArr",JSON.stringify(favs)),paintSeries(favs,!0)}function indexOfSerieInFav(e,t){for(let n=0;n<t.length;n++)if(t[n].id===e.dataset.id)return n;return-1}function favButtonHandler(){favButton.classList.toggle("rotFav"),favButton.classList.toggle("defaultFavAnimation"),favPanel.classList.toggle("favPanelTransition")}function favRemoveHandler(e){let t=e.currentTarget.parentNode.dataset.id;for(let e=0;e<favs.length;e++)favs[e].id===t&&favs.splice(e,1);localStorage.setItem("favIdArr",JSON.stringify(favs)),paintSeries(favs,!0);for(const e of Array.from(listSeriesElem.childNodes))e.dataset.id===t&&e.classList.remove("fav")}function favRemoveAllHandler(){favs=[],localStorage.setItem("favIdArr",JSON.stringify(favs)),paintSeries(favs,!0);for(const e of Array.from(listSeriesElem.childNodes))e.classList.remove("fav")}function randomInRangeFloat(e,t){return Math.random()*(t-e)+e}function randomInRangeInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}function vwToPx(e){return e*document.documentElement.clientWidth/100}function pxToVw(e){return e*(100/document.documentElement.clientWidth)}function cloudsIniPos(e){for(let t=0;t<(e?1:randomInRangeInt(4,8));t++){const t=randomInRangeInt(1,4),n=document.createElement("object");if(n.setAttribute("type","image/svg+xml"),n.setAttribute("data",`./assets/images/cloud${t}.svg`),n.classList.add("js-cloud","cloud"),cloudsElem.appendChild(n),e){const e=randomInRangeFloat(.2,2);return n.style.top=randomInRangeInt(-5,95)+"vh",n.style.left=-300*e-20+"px",n.style.transform=`scale(${e})`,void(n.dataset.speed=1+1/e)}}for(const e of cloudsElem.childNodes){const t=randomInRangeFloat(.2,2);e.style.top=randomInRangeInt(-5,105)+"vh",e.style.left=randomInRangeInt(-5,105)+"vw",e.style.left=vwToPx(e.style.left.slice(0,-2))+"px",e.style.transform=`scale(${t})`,e.dataset.speed=1+1/t}}function cloudMoveHandler(){for(const e of cloudsElem.childNodes){let t=parseInt(e.style.left.slice(0,-2));e.style.left=t+5*parseFloat(e.dataset.speed)+"px",pxToVw(t)>100&&(e.remove(),cloudsIniPos(!0))}}function starsIniPos(){for(let e=0;e<randomInRangeInt(50,80);e++){const e=randomInRangeInt(1,4),t=document.createElement("object");t.setAttribute("type","image/svg+xml"),t.setAttribute("data",`./assets/images/star${e}.svg`),t.classList.add("js-star","star","star"+e),starsElem.appendChild(t)}for(const e of starsElem.childNodes){const t=randomInRangeFloat(.05,.35);e.style.top=randomInRangeInt(-5,105)+"vh",e.style.left=randomInRangeInt(-5,105)+"vw",e.style.opacity=""+t}}function starLitHandler(){for(const e of starsElem.childNodes)randomInRangeFloat(0,1)>=.9&&(e.classList.add("starAnimation"),e.addEventListener("webkitAnimationEnd",e=>e.currentTarget.classList.remove("starAnimation")),e.addEventListener("animationend",e=>e.currentTarget.classList.remove("starAnimation")))}function hex(e){var t="0123456789abcdef",n=parseInt(e);return 0==n||isNaN(e)?"00":(n=Math.round(Math.min(Math.max(0,n),255)),t.charAt((n-n%16)/16)+t.charAt(n%16))}function convertToHex(e){return hex(e[0])+hex(e[1])+hex(e[2])}function trim(e){return"#"==e.charAt(0)?e.substring(1,7):e}function convertToRGB(e){var t=[];return t[0]=parseInt(trim(e).substring(0,2),16),t[1]=parseInt(trim(e).substring(2,4),16),t[2]=parseInt(trim(e).substring(4,6),16),t}function generateColor(e,t,n){var a=convertToRGB(e),s=convertToRGB(t),r=n,o=0,l=[];l.push(trim(t));for(let e=0;e<r;e++){var i=[];o+=1/r,i[0]=a[0]*o+(1-o)*s[0],i[1]=a[1]*o+(1-o)*s[1],i[2]=a[2]*o+(1-o)*s[2],l.push(convertToHex(i))}return l}function genSky(){const e=generateColor("#4c566a","#2e3440",25);for(let t=0;t<e.length;t++){const n=document.createElement("div");n.classList.add("stripe"),n.style.backgroundColor="#"+e[t],n.style.height=100/e.length+"vh",skyElem.appendChild(n)}}function init(){localStorage.getItem("favIdArr")&&(favs=JSON.parse(localStorage.getItem("favIdArr"))),favs&&paintSeries(favs,!0),genSky(),cloudsIniPos(!1),starsIniPos()}setInterval(cloudMoveHandler,2e3),setInterval(starLitHandler,5e3),searchButtonElem.addEventListener("click",searchHandler),inputElem.addEventListener("submit",searchHandler),inputElem.addEventListener("keyup",searchHandler),listSeriesElem.addEventListener("click",favHandler),favButton.addEventListener("click",favButtonHandler),clearAllButton.addEventListener("click",favRemoveAllHandler);